"use strict";(self.webpackChunkoneboy_app=self.webpackChunkoneboy_app||[]).push([[4879],{1911:(e,n,d)=>{d.d(n,{R:()=>i,x:()=>l});var t=d(9729);const s={},r=t.createContext(s);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(r.Provider,{value:n},e.children)}},5619:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>j,frontMatter:()=>i,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"Database/\u9910\u9986\u8425\u4e1a\u989d\u53d8\u5316\u589e\u957f","title":"1321.\u9910\u9986\u8425\u4e1a\u989d\u53d8\u5316\u589e\u957f","description":"|\u5e8f\u53f7|\u9898\u76ee|\u96be\u5ea6|","source":"@site/leetcode/Database/1321.\u9910\u9986\u8425\u4e1a\u989d\u53d8\u5316\u589e\u957f.md","sourceDirName":"Database","slug":"/1321","permalink":"/leetcode/1321","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1752486786000,"sidebarPosition":1321,"frontMatter":{"sidebar_position":1321,"slug":"/1321"},"sidebar":"leetcodeSidebar","previous":{"title":"1280.\u5b66\u751f\u4eec\u53c2\u52a0\u5404\u79d1\u6d4b\u8bd5\u7684\u6b21\u6570","permalink":"/leetcode/1280"},"next":{"title":"1327.\u5217\u51fa\u6307\u5b9a\u65f6\u95f4\u6bb5\u5185\u6240\u6709\u7684\u4e0b\u5355\u4ea7\u54c1","permalink":"/leetcode/1327"}}');var s=d(5813),r=d(1911);const i={sidebar_position:1321,slug:"/1321"},l="1321.\u9910\u9986\u8425\u4e1a\u989d\u53d8\u5316\u589e\u957f",c={},h=[{value:"\u9898\u76ee\u5927\u610f",id:"\u9898\u76ee\u5927\u610f",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:3},{value:"\u8f93\u5165",id:"\u8f93\u5165",level:4},{value:"\u8f93\u51fa",id:"\u8f93\u51fa",level:4},{value:"\u89e3\u91ca",id:"\u89e3\u91ca",level:4},{value:"\u53c2\u8003\u7b54\u6848",id:"\u53c2\u8003\u7b54\u6848",level:2}];function x(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"1321\u9910\u9986\u8425\u4e1a\u989d\u53d8\u5316\u589e\u957f",children:"1321.\u9910\u9986\u8425\u4e1a\u989d\u53d8\u5316\u589e\u957f"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u5e8f\u53f7"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u9898\u76ee"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u96be\u5ea6"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"1321"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.a,{href:"https://leetcode.com/problems/restaurant-growth",children:"\u9898\u76ee\u94fe\u63a5"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u4e2d\u7b49"})]})})]}),"\n",(0,s.jsx)(n.h2,{id:"\u9898\u76ee\u5927\u610f",children:"\u9898\u76ee\u5927\u610f"}),"\n",(0,s.jsx)(n.p,{children:"\u4f60\u662f\u9910\u9986\u7684\u8001\u677f\uff0c\u73b0\u5728\u4f60\u60f3\u5206\u6790\u4e00\u4e0b\u53ef\u80fd\u7684\u8425\u4e1a\u989d\u53d8\u5316\u589e\u957f\uff08\u6bcf\u5929\u81f3\u5c11\u6709\u4e00\u4f4d\u987e\u5ba2\uff09\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u8ba1\u7b97\u4ee5 7 \u5929\uff08\u67d0\u65e5\u671f + \u8be5\u65e5\u671f\u524d\u7684 6 \u5929\uff09\u4e3a\u4e00\u4e2a\u65f6\u95f4\u6bb5\u7684\u987e\u5ba2\u6d88\u8d39\u5e73\u5747\u503c\u3002average_amount \u8981 \u4fdd\u7559\u4e24\u4f4d\u5c0f\u6570\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u7ed3\u679c\u6309 visited_on \u5347\u5e8f\u6392\u5e8f\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u8868: ",(0,s.jsx)(n.strong,{children:"Customer"})]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Column Name"}),(0,s.jsx)(n.th,{children:"Type"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"customer_id"}),(0,s.jsx)(n.td,{children:"int"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"name"}),(0,s.jsx)(n.td,{children:"varchar"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"visited_on"}),(0,s.jsx)(n.td,{children:"date"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"amount"}),(0,s.jsx)(n.td,{children:"int"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 SQL \u4e2d\uff0c(",(0,s.jsx)(n.code,{children:"customer_id"}),", ",(0,s.jsx)(n.code,{children:"visited_on"}),") \u662f\u8be5\u8868\u7684\u4e3b\u952e\u3002\n\u8be5\u8868\u5305\u542b\u4e00\u5bb6\u9910\u9986\u7684\u987e\u5ba2\u4ea4\u6613\u6570\u636e\u3002\n",(0,s.jsx)(n.code,{children:"visited_on"})," \u8868\u793a (",(0,s.jsx)(n.code,{children:"customer_id"}),") \u7684\u987e\u5ba2\u5728 ",(0,s.jsx)(n.code,{children:"visited_on"})," \u90a3\u5929\u8bbf\u95ee\u4e86\u9910\u9986\u3002\n",(0,s.jsx)(n.code,{children:"amount"})," \u662f\u4e00\u4e2a\u987e\u5ba2\u67d0\u4e00\u5929\u7684\u6d88\u8d39\u603b\u989d\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,s.jsx)(n.h4,{id:"\u8f93\u5165",children:"\u8f93\u5165"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Customer"})," \u8868:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"customer_id"}),(0,s.jsx)(n.th,{children:"name"}),(0,s.jsx)(n.th,{children:"visited_on"}),(0,s.jsx)(n.th,{children:"amount"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"Jhon"}),(0,s.jsx)(n.td,{children:"2019-01-01"}),(0,s.jsx)(n.td,{children:"100"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"Daniel"}),(0,s.jsx)(n.td,{children:"2019-01-02"}),(0,s.jsx)(n.td,{children:"110"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"Jade"}),(0,s.jsx)(n.td,{children:"2019-01-03"}),(0,s.jsx)(n.td,{children:"120"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4"}),(0,s.jsx)(n.td,{children:"Khaled"}),(0,s.jsx)(n.td,{children:"2019-01-04"}),(0,s.jsx)(n.td,{children:"130"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"5"}),(0,s.jsx)(n.td,{children:"Winston"}),(0,s.jsx)(n.td,{children:"2019-01-05"}),(0,s.jsx)(n.td,{children:"110"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"6"}),(0,s.jsx)(n.td,{children:"Elvis"}),(0,s.jsx)(n.td,{children:"2019-01-06"}),(0,s.jsx)(n.td,{children:"140"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"7"}),(0,s.jsx)(n.td,{children:"Anna"}),(0,s.jsx)(n.td,{children:"2019-01-07"}),(0,s.jsx)(n.td,{children:"150"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"Maria"}),(0,s.jsx)(n.td,{children:"2019-01-08"}),(0,s.jsx)(n.td,{children:"80"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"9"}),(0,s.jsx)(n.td,{children:"Jaze"}),(0,s.jsx)(n.td,{children:"2019-01-09"}),(0,s.jsx)(n.td,{children:"110"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"Jhon"}),(0,s.jsx)(n.td,{children:"2019-01-10"}),(0,s.jsx)(n.td,{children:"130"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"Jade"}),(0,s.jsx)(n.td,{children:"2019-01-10"}),(0,s.jsx)(n.td,{children:"150"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"\u8f93\u51fa",children:"\u8f93\u51fa"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"visited_on"}),(0,s.jsx)(n.th,{children:"amount"}),(0,s.jsx)(n.th,{children:"average_amount"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2019-01-07"}),(0,s.jsx)(n.td,{children:"860"}),(0,s.jsx)(n.td,{children:"122.86"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2019-01-08"}),(0,s.jsx)(n.td,{children:"840"}),(0,s.jsx)(n.td,{children:"120"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2019-01-09"}),(0,s.jsx)(n.td,{children:"840"}),(0,s.jsx)(n.td,{children:"120"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2019-01-10"}),(0,s.jsx)(n.td,{children:"1000"}),(0,s.jsx)(n.td,{children:"142.86"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"\u89e3\u91ca",children:"\u89e3\u91ca"}),"\n",(0,s.jsx)(n.p,{children:"\u7b2c\u4e00\u4e2a\u4e03\u5929\u6d88\u8d39\u5e73\u5747\u503c\u4ece 2019-01-01 \u5230 2019-01-07 \u662frestaurant-growth/restaurant-growth/ (100 + 110 + 120 + 130 + 110 + 140 + 150)/7 = 122.86\n\u7b2c\u4e8c\u4e2a\u4e03\u5929\u6d88\u8d39\u5e73\u5747\u503c\u4ece 2019-01-02 \u5230 2019-01-08 \u662f (110 + 120 + 130 + 110 + 140 + 150 + 80)/7 = 120\n\u7b2c\u4e09\u4e2a\u4e03\u5929\u6d88\u8d39\u5e73\u5747\u503c\u4ece 2019-01-03 \u5230 2019-01-09 \u662f (120 + 130 + 110 + 140 + 150 + 80 + 110)/7 = 120\n\u7b2c\u56db\u4e2a\u4e03\u5929\u6d88\u8d39\u5e73\u5747\u503c\u4ece 2019-01-04 \u5230 2019-01-10 \u662f (130 + 110 + 140 + 150 + 80 + 110 + 130 + 150)/7 = 142.86"}),"\n",(0,s.jsx)(n.h2,{id:"\u53c2\u8003\u7b54\u6848",children:"\u53c2\u8003\u7b54\u6848"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-SQL",children:"with t0 as (\nSELECT \n  visited_on\n, sum(amount) amount \nfrom Customer\ngroup by 1\n),\nt1 as (\nSELECT\ndate_add(visited_on, interval 6 day) saven_day_ago\nfrom Customer\ngroup by 1\n)\nSELECT\n visited_on\n,amount\n,round(amount/7,2) as average_amount\nfrom (\nSELECT\n t0.visited_on\n,sum(t0.amount) over(order by t0.visited_on ROWS 6 PRECEDING) amount\n,t1.saven_day_ago\nfrom t0\nleft join t1\nON t0.visited_on = t1.saven_day_ago\n) a\nwhere saven_day_ago is not null\norder by 1\n;\n"})})]})}function j(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(x,{...e})}):x(e)}}}]);